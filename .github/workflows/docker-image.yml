name: Fontend-CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:

  build:

    runs-on: [self-hosted, linux, x64]

    steps:
    - uses: actions/checkout@v3
    - name: Secret
      env:
        ENV_FILE: ${{ secrets.ENV_FILE }}
      # run: echo $ENV_FILE | base64 -d > .env
      run: echo $ENV_FILE
    - name: Build the Docker image
      run: docker build . --file Dockerfile --tag harbor.kafana.dev/ptin/bhfe:test || echo "docker build failed"
    - name: Push the Docker image
      run: docker push harbor.kafana.dev/ptin/bhfe:test

    - name: Executing remote ssh command
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.SSH_HOST }}
        username: ${{ secrets.SSH_USER }}
        key: ${{ secrets.SSH_KEY }}
        script: |
                    ls -la
                    # bash /opt/git/my-repository/update.sh